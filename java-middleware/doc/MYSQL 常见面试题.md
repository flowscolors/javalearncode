
Q:Mysql(innondb 下同) 有哪几种事务隔离级别？
A:读未提交、读已提交、可重复读、串行化。

Q:不同事务隔离级别分别会加哪些锁？
读未提交  
读已提交
可重复读
串行化

Q:mysql的行锁、表锁、间隙锁、意向锁分别是做什么的？
行锁，一般select ·· for update会添加。
表锁，一般需要使用lock指令，一般由系统线程触发时发生。
间隙锁，当查询里面带where时，扩大表锁范围，把对应的索引页锁了。
意向锁，

Q:mysql多事务执行会产生哪些问题，怎么解决这些问题
A:多事务执行会因为隔离等级的不同，分别产生脏读、不可重复读、幻读。
脏读，读到还未提交的事务。
不可重复读，因为能读已提交事务，同一事务的两次查询会出现不一样的结果。
幻读，在一个事务内读取到了别的事务插入的数据，导致前后读取不一致。也叫写倾斜，比如两个事务执行同样的select，如果不存在则插入，存在则更新，则结果要么都插入，主键冲突，要么一个插入一个更新。

Q:mysql怎么解决幻读的?
A:数据库原理中对幻读是需要串行化解决的，MySQL则使用了MVCC和锁来进行控制。

---
Q: 聚集索引和非聚集索引的区别?
A:聚集索引(Clustered)：指在存储的页中，存储了索引key对应的全部value。
非聚集索引(Non-clustered)：指在存储页中，存储索引key对应的是另一个页的引用，实际获取value需要再进行一次IO去找数据。
非聚集索引指定表的逻辑顺序，也可以视为二级索引。数据存储在一个位置，索引存储在另一个位置，索引中包含指向数据存储位置的指针.

Q:MySQL主键索引和联合索引在底层数据结构的区别？
A:聚簇索引(主键索引)  聚簇索引是叶子节点保存了数据。而普通索引叶子节点保存的是主键索引的页地址。

Q:mysql索引左前缀原理，怎么优化，哪些字段适合建索引，索引有什么优缺点
A:在MySQL建立联合索引时会遵守最左前缀匹配原则，即最左优先，在检索数据时从联合索引的最左边开始匹配。
索引的底层是一颗B+树，那么联合索引的底层也就是一颗B+树，只不过联合索引的B+树节点中存储的是键值。由于构建一棵B+树只能根据一个值来确定索引关系，所以数据库依赖联合索引最左的字段来构建。
对于(a,b)的联合索引，由于索引树中a的值有序，当确定a的值时b的值有序，但是直接查b的值是无序的。所以必须按最左匹配。

Q:说说什么是最左匹配？
A:在MySQL建立联合索引时会遵守最左前缀匹配原则，即最左优先，在检索数据时从联合索引的最左边开始匹配。
索引的底层是一颗B+树，那么联合索引的底层也就是一颗B+树，只不过联合索引的B+树节点中存储的是键值。由于构建一棵B+树只能根据一个值来确定索引关系，所以数据库依赖联合索引最左的字段来构建。

Q:mysql索引为什么用的是b+ tree而不是b tree、红黑树
A:从二叉树 -> avl树 -> b树 -> b+树
b+树非叶子节点不存储具体数据，降低树的高度，减少磁盘IO。且叶子节点有前后指针关系，便于范围查询。

Q:mysql中有一个索引(a,b,c)，有一条sql，where a = 1 and b > 1 and c =1;可以用到索引么，为什么没用到，B+树的结构，为什么不用红黑树，B树，一千万的数据大概多少次io

Q:mysql索引失效的原则?
A:违反最左前缀法则、模糊匹配、使用or、使用计算符、order by索引失效、costs过大，比如需要回表查询数据过多。

Q:mysql聚簇索引，覆盖索引，底层结构，主键索引，没有主键怎么办，会自己生成主键为什么还要自定义主键，自动生成的主键有什么问题
A:主键索引，叶子节点存全部数据。覆盖索引，查询的数据就是索引里面的。底层结构哦，基于页的节点结构的B+树。没有主键会自动生成自增的主键。

Q:如何优化慢查询？
A:首先得开慢查询配置，然后记录慢查询。然后看为什么慢，可以用Explain查看执行计划来进行优化。profiling命令使用当真正无法继续优化的时候可以去加配置。

Q:线上遇到过慢查询么，怎么定位，优化的，explain，using filesort表示什么意思，产生原因，怎么解决
A:首先数据库需要开慢查询配置，定位根据SQL定位。多表join、分页count过于复杂。explian，使用文件排序，指生成临时表，在其中进行order by操作，优化让order by的字段走索引。

Q:mysql join的底层原理是什么，有哪几种(不是左右连接这种)

---
Q:mysql的log, binlog redolog undolog?
redolog保证事务的提交，持久性，写入redolog证明事务在两阶段加锁的prepare阶段，后面就能正常执行了，先写redolog，再写binlog。MySQl Server层需要，作为异常宕机或者介质故障后的数据恢复使用。
binlog是存储引擎用的，用来保证数据库执行指令的存档。
undolog保证事务的原子性，undo log 提供了回滚和多个行版本控制（MVCC），如果因为某些原因导致事务执行失败回滚了，可以借助 undo log 进行回滚，记录每个命令的对应命令。

Q:mysql日志文件有哪些，分别介绍下作用
A:主要三大日志binlog、redolog、undolog。
redolog保证事务的提交，持久性，写入redolog证明事务在两阶段加锁的prepare阶段，后面就能正常执行了，先写redolog，再写binlog。MySQl Server层需要，作为异常宕机或者介质故障后的数据恢复使用。
binlog是存储引擎用的，用来保证数据库执行指令的存档。
undolog保证事务的原子性，undo log 提供了回滚和多个行版本控制（MVCC），如果因为某些原因导致事务执行失败回滚了，可以借助 undo log 进行回滚，记录每个命令的对应命令。

Q:Innodb的结构了解么，磁盘页和缓存区是怎么配合，以及查找的，缓冲区和磁盘数据不一致怎么办，mysql突然宕机了会出现数据丢失么
A:基于页的节点结构的B+树。磁盘页和缓存区，虚拟内存，缺页冲突。数据不会丢，有持久化和binlog。

Q:分库分表如何选择分表键

Q:分库分表的情况下，查询时一般是如何做排序的？

Q:分库分表做过么，怎么做到不停机扩容，双写数据丢失怎么办，跨库事务怎么解决

Q:mysql主从复制，主从延时怎么解决
A:如果一定要写完立马读，那就只能读主库。

Q:一张大表怎么更改表的数据结构，字段，用alter会有什么问题，怎么解决呢，有什么好的方案，双写的话会有什么问题，还有其他方案么
A:表锁了，使用影子表。

Q:mysql事务，acid，实现原理，脏读，脏写，隔离级别，实现原理，mvcc，幻读，间隙锁原理，什么情况下会使用间隙锁，锁失效怎么办，其他锁了解么，行锁，表锁

Q:MySQL如何保持一致性？




