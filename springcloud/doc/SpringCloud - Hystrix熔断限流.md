
微服务需要具备应用分布式系统的可容错性，需要对可能发生的故障涉及出相应的软件隔离机制和措施，需要相应的容错策略。

面向失败的涉及其实就有一点混沌的思想了。

## 线程隔离 Hystrix
容器代表的是进程之间的隔离。而Hystrix则可以实现内部线程池的隔离。当然你实际自己写代码做也可以做到隔离，比如服务A和服务B用不同线程池。
但是框架层的一般不会自己改，而Hystrix解决的就是请求处理的线程池隔离，比如把对接口A的请求发到线程池A、对接口B的请求发到线程池B。


## 熔断与降级
两者的共性都是用来保护系统，防止系统整体崩溃的技术手段。熔断直接服务就不可达，降级会在不可达的时候返回一个默认值。
区别大致有：
1.触发条件的区别。熔断通常主动触发，降级一般是代码中定义好的逻辑（比如失败多少次降级、超时降级、故障降级、限流降级）。
2.分级的差别。熔断通常依赖整体框架，降级则不同业务优先级的服务需要具体考虑。

SpringCloud中实际使用降级的2种手段，两者都使用注解方式使用：
1.使用FeginClient进行服务降级。
@FeignClient(value="order",configuration = OrderClientConfiguration.class , fallback = OrderClientFallback.class)

2.在Hystrix中使用fallbackMethod实现服务降级。
@HystrixCommand(fallbackMethod = "fallbackMethod"


## 限流
为了保护系统不被大量请求冲垮，通过限制请求的速度来保护系统。

### 计数器
维护一个单位时间的计数器，每次请求+1，加到阈值则拒绝请求。缺点是会产生流量突刺。

### 漏桶算法
为解决流量突刺产生的算法，按照一定速率往桶里放权限，保证平均请求。

### 令牌桶算法
为解决流量突刺产生的算法，按照一定时间间隔（1/QPS）往桶里放令牌，每次请求消耗一个令牌，保证平均请求。

### Guava限流器
Guava限流器 RateLimiter，基于令牌桶算法实现的一个多线程限流器，只能进行单机限流。


## 熔断器Hystrix
Hystrix可以在一定时间内调用服务次数达到阈值，并且失败次数也到达失败阈值时（默认50%），进行服务熔断。让服务调用方调用本地的降级方法。
所以这个Hystrix实际是Only应用提供发编写的，并且需要告知应用调用方。
当然Hystrix的特点就是 ，它可以自我反馈，自我修复，当一定时间内接口请求正常，会恢复请求。
为了实现这个功能，Hystrix规定了 关闭closed、打开open、半开half-open三种状态，并维护切换。






